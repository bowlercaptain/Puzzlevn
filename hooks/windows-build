#!/bin/bash

#set -e
while [ -e Temp/UnityLockFile ]
do
	echo I cannot build while the project is still open in Unity. I will wait 5 seconds and try again.
	sleep 5
done

echo "executing build"
"$unityLocation" -batchmode -quit -projectpath $projectFolder -buildWindowsPlayer $workingFolder/$projectName/$projectName.exe

echo "running tests"
set -e
"$MSBuildLocation" tests/KusoTest/KusoTest.sln
"$MSTestLocation" /testcontainer:tests/KusoTest/KusoTest/bin/Debug/KusoTest.dll

hooks/butler push $workingFolder/$projectName $itchURL:windows$1
echo "pushed!"